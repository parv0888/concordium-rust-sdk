<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Various constants and functions used by both `v0` and `v1` execution engines. The constants and functions range from limits on sizes of objects, to costs of different operations."><meta name="keywords" content="rust, rustlang, rust-lang, constants"><title>concordium_smart_contract_engine::constants - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../concordium_smart_contract_engine/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module constants</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="constants" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">concordium_smart_contract_engine</a>::<wbr><a class="mod" href="#">constants</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/concordium_smart_contract_engine/constants.rs.html#1-261" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Various constants and functions used by both <a href="../v0/index.html"><code>v0</code></a> and
<a href="../v1/index.html"><code>v1</code></a> execution engines. The constants and functions range from
limits on sizes of objects, to costs of different operations.</p>
</div></details><h2 id="constants" class="section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BASE_ACTION_COST.html" title="concordium_smart_contract_engine::constants::BASE_ACTION_COST constant">BASE_ACTION_COST</a></div><div class="item-right docblock-short"><p>Base cost of any action. With this cost there can be at most
3_000_000 actions produced in a block (with 3_000_000NRG maximum).
A memory representation of a single action is 16 bytes, which
would lead to 48MB memory being used temporarily for the buffer.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BASE_SEND_ACTION_COST.html" title="concordium_smart_contract_engine::constants::BASE_SEND_ACTION_COST constant">BASE_SEND_ACTION_COST</a></div><div class="item-right docblock-short"><p>Base cost of a send action. There is more data and it also requires
allocations which are a significant cost. The fixed amount of data is 72
bytes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BASE_SIMPLE_TRANSFER_ACTION_COST.html" title="concordium_smart_contract_engine::constants::BASE_SIMPLE_TRANSFER_ACTION_COST constant">BASE_SIMPLE_TRANSFER_ACTION_COST</a></div><div class="item-right docblock-short"><p>Base cost of a simple_transfer action. There is more data (40 bytes) and it
also requires allocations which are a significant cost.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BASE_STATE_COST.html" title="concordium_smart_contract_engine::constants::BASE_STATE_COST constant">BASE_STATE_COST</a></div><div class="item-right docblock-short"><p>Cost of accessing the instance state.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.DELETE_ITERATOR_BASE_COST.html" title="concordium_smart_contract_engine::constants::DELETE_ITERATOR_BASE_COST constant">DELETE_ITERATOR_BASE_COST</a></div><div class="item-right docblock-short"><p>Basic administrative cost that is charged when an invalid iterator is
attempted to be deleted.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.ENTRY_SIZE_COST.html" title="concordium_smart_contract_engine::constants::ENTRY_SIZE_COST constant">ENTRY_SIZE_COST</a></div><div class="item-right docblock-short"><p>Cost of querying entry size.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.INVOKE_BASE_COST.html" title="concordium_smart_contract_engine::constants::INVOKE_BASE_COST constant">INVOKE_BASE_COST</a></div><div class="item-right docblock-short"><p>Cost of the invoke action. This is just the base cost to cover
administrative costs of an invoke. Specific costs of the action are charged
later by the scheduler.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.ITERATOR_KEY_SIZE_COST.html" title="concordium_smart_contract_engine::constants::ITERATOR_KEY_SIZE_COST constant">ITERATOR_KEY_SIZE_COST</a></div><div class="item-right docblock-short"><p>Cost of return the size of the iterator key. This is constant since the
iterator key is readily available.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.ITERATOR_NEXT_COST.html" title="concordium_smart_contract_engine::constants::ITERATOR_NEXT_COST constant">ITERATOR_NEXT_COST</a></div><div class="item-right docblock-short"><p>Basic administrative cost of advancing an iterator.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.LOG_EVENT_BASE_COST.html" title="concordium_smart_contract_engine::constants::LOG_EVENT_BASE_COST constant">LOG_EVENT_BASE_COST</a></div><div class="item-right docblock-short"><p>Base cost of a log event call.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_ACTIVATION_FRAMES.html" title="concordium_smart_contract_engine::constants::MAX_ACTIVATION_FRAMES constant">MAX_ACTIVATION_FRAMES</a></div><div class="item-right docblock-short"><p>Maximum number of nested function calls.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_CONTRACT_STATE.html" title="concordium_smart_contract_engine::constants::MAX_CONTRACT_STATE constant">MAX_CONTRACT_STATE</a></div><div class="item-right docblock-short"><p>Maximum size of a V0 contract state in bytes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_ENTRY_SIZE.html" title="concordium_smart_contract_engine::constants::MAX_ENTRY_SIZE constant">MAX_ENTRY_SIZE</a></div><div class="item-right docblock-short"><p>Maximum size (in bytes) of data in the entry. The execution engine relies on
this being strictly less than <a href="https://doc.rust-lang.org/1.57.0/std/primitive.u32.html#associatedconstant.MAX" title="u32::MAX">u32::MAX</a>.
Realistically this is much above any bound implied by energy, however it is
good to have it explicit since correctness of the implementation relies on
this.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_KEY_SIZE.html" title="concordium_smart_contract_engine::constants::MAX_KEY_SIZE constant">MAX_KEY_SIZE</a></div><div class="item-right docblock-short"><p>Maximum size of a key in V1 contract state. The execution engine relies on
this being strictly less than <a href="https://doc.rust-lang.org/1.57.0/std/primitive.u32.html#associatedconstant.MAX" title="u32::MAX">u32::MAX</a>.
Realistically this is much above any bound implied by energy, however it is
good to have it explicit since correctness of the implementation relies on
this.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_LOG_SIZE.html" title="concordium_smart_contract_engine::constants::MAX_LOG_SIZE constant">MAX_LOG_SIZE</a></div><div class="item-right docblock-short"><p>Maximum size of a log message.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_NUM_LOGS.html" title="concordium_smart_contract_engine::constants::MAX_NUM_LOGS constant">MAX_NUM_LOGS</a></div><div class="item-right docblock-short"><p>Maximum number of log messages per execution in <em>protocol version 4 and
lower</em>. This, together with the previous constant, limits the amount of data
that can be logged to 16kB.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MEMORY_COST_FACTOR.html" title="concordium_smart_contract_engine::constants::MEMORY_COST_FACTOR constant">MEMORY_COST_FACTOR</a></div><div class="item-right docblock-short"><p>Cost of allocation of one page of memory in relation to execution cost.
FIXME: It is unclear whether this is really necessary with the hard limit we
have on memory use.
If we keep it, the cost must be analyzed and put into perspective</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.RESIZE_ENTRY_BASE_COST.html" title="concordium_smart_contract_engine::constants::RESIZE_ENTRY_BASE_COST constant">RESIZE_ENTRY_BASE_COST</a></div><div class="item-right docblock-short"><p>Base cost of resizing an entry. This accounts for lookup of the entry.
When the entry is resized to a larger value there is additional cost charged
based on how much extra memory there is.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.TREE_TRAVERSAL_STEP_COST.html" title="concordium_smart_contract_engine::constants::TREE_TRAVERSAL_STEP_COST constant">TREE_TRAVERSAL_STEP_COST</a></div><div class="item-right docblock-short"><p>Step cost of a tree traversal when invalidating entries when deleting a
prefix, as well as when advancing an iterator.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.VERIFY_ECDSA_SECP256K1_COST.html" title="concordium_smart_contract_engine::constants::VERIFY_ECDSA_SECP256K1_COST constant">VERIFY_ECDSA_SECP256K1_COST</a></div><div class="item-right docblock-short"><p>Cost of verification of an ecdsa over secp256k1 with the bitcoin-core
implementation. Since signature verification only works on 32 byte messages
(which are meant to be hashes) the cost is constant.</p>
</div></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.action_send_cost.html" title="concordium_smart_contract_engine::constants::action_send_cost fn">action_send_cost</a></div><div class="item-right docblock-short"><p>Cost of a <code>send</code> action of a v0 contract. <code>x</code> is the size of the parameter
in bytes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.additional_entry_size_cost.html" title="concordium_smart_contract_engine::constants::additional_entry_size_cost fn">additional_entry_size_cost</a></div><div class="item-right docblock-short"><p>Cost of allocating additional data in the entry. The argument is the
number of additional bytes.
This is needed since we do allocate memory on entry_resize. As a result
we must bound how much can be allocated.
With <code>100</code> we have at most 30MB of memory allocated with 3000000NRG. We can
relax this a bit, but not much.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.additional_output_size_cost.html" title="concordium_smart_contract_engine::constants::additional_output_size_cost fn">additional_output_size_cost</a></div><div class="item-right docblock-short"><p>Cost of adding an additional byte to the output. With the factor of 30
and 3000000NRG there can be at most 100MB of output produced.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.additional_state_size_cost.html" title="concordium_smart_contract_engine::constants::additional_state_size_cost fn">additional_state_size_cost</a></div><div class="item-right docblock-short"><p>Cost of allocating additional smart contract state. The argument is the
number of additional bytes. The <code>/100</code> guarantees that with 3_000_000NRG
we can produce at most 30MB additional contract state per block.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.copy_from_host_cost.html" title="concordium_smart_contract_engine::constants::copy_from_host_cost fn">copy_from_host_cost</a></div><div class="item-right docblock-short"><p>Cost of copying the given amount of bytes from the host (e.g., policy or
contract state) to the Wasm memory. The 10 is to account for copying empty
buffers and is based on benchmarks.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.copy_parameter_cost.html" title="concordium_smart_contract_engine::constants::copy_parameter_cost fn">copy_parameter_cost</a></div><div class="item-right docblock-short"><p>Cost of copying a V1 parameter between the Wasm memory and the host in
either direction.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.copy_to_host_cost.html" title="concordium_smart_contract_engine::constants::copy_to_host_cost fn">copy_to_host_cost</a></div><div class="item-right docblock-short"><p>Cost of copying the given amount of bytes to the host (e.g., contract state)
from the Wasm to host memory. The 10 is to account for
copying empty buffers and is based on benchmarks.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.create_entry_cost.html" title="concordium_smart_contract_engine::constants::create_entry_cost fn">create_entry_cost</a></div><div class="item-right docblock-short"><p>Cost of creating an entry in the instance state.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.delete_entry_cost.html" title="concordium_smart_contract_engine::constants::delete_entry_cost fn">delete_entry_cost</a></div><div class="item-right docblock-short"><p>Cost of deleting an entry based on key length. This involves lookup in the
“locked” map so it is relatively expensive.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.delete_iterator_cost.html" title="concordium_smart_contract_engine::constants::delete_iterator_cost fn">delete_iterator_cost</a></div><div class="item-right docblock-short"><p>Delete an iterator. Since we need to unlock the region locked by it this
cost is based on the length of the key. The exact factor of 32 is estimated
based on benchmarks.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.delete_prefix_find_cost.html" title="concordium_smart_contract_engine::constants::delete_prefix_find_cost fn">delete_prefix_find_cost</a></div><div class="item-right docblock-short"><p>Cost of delete_prefix which accounts for finding the prefix. It is
parametrized by the length of the key.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.hash_keccak_256_cost.html" title="concordium_smart_contract_engine::constants::hash_keccak_256_cost fn">hash_keccak_256_cost</a></div><div class="item-right docblock-short"><p>Cost of computing a Keccak-256 digest of the message of the given length.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.hash_sha2_256_cost.html" title="concordium_smart_contract_engine::constants::hash_sha2_256_cost fn">hash_sha2_256_cost</a></div><div class="item-right docblock-short"><p>Cost of computing a SHA2-256 digest of the message of the given length.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.hash_sha3_256_cost.html" title="concordium_smart_contract_engine::constants::hash_sha3_256_cost fn">hash_sha3_256_cost</a></div><div class="item-right docblock-short"><p>Cost of computing a SHA3-256 digest of the message of the given length.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.log_event_cost.html" title="concordium_smart_contract_engine::constants::log_event_cost fn">log_event_cost</a></div><div class="item-right docblock-short"><p>Cost of logging an event of a given size.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.lookup_entry_cost.html" title="concordium_smart_contract_engine::constants::lookup_entry_cost fn">lookup_entry_cost</a></div><div class="item-right docblock-short"><p>Cost of looking up an entry in the instance state.
Compared to creating an entry this does not require extra storage for the
key. The only cost is tree traversal and storing an indirection, which is 8
bytes. With this cost we limit the amount of extra storage that is needed.
For each entry lookup we allocate a new pointer indirection. Which is 8
bytes. With these costs we limit the amount of memory needed to store these
indirections to 300MB for 3_000_000NRG (with current conversion rates of NRG
to InterpreterEnergy).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.new_iterator_cost.html" title="concordium_smart_contract_engine::constants::new_iterator_cost fn">new_iterator_cost</a></div><div class="item-right docblock-short"><p>Cost of a new iterator. This accounts for tree traversal as well
as the storage the execution engine needs to keep for the iterator.
When looking up an iterator we construct a structure that keeps track of the
current position in the tree. This iterator is constructed for any key,
including the empty key. Hence the base cost of 80 is there to ensure we
don’t run out of memory. It limits memory use to around 300MB in the worst
case.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.read_entry_cost.html" title="concordium_smart_contract_engine::constants::read_entry_cost fn">read_entry_cost</a></div><div class="item-right docblock-short"><p>Cost of copying the given amount of bytes from the host (e.g., parameter or
contract state) to the Wasm memory.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.traverse_key_cost.html" title="concordium_smart_contract_engine::constants::traverse_key_cost fn">traverse_key_cost</a></div><div class="item-right docblock-short"><p>Cost of traversing a key in the instance state.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.verify_ed25519_cost.html" title="concordium_smart_contract_engine::constants::verify_ed25519_cost fn">verify_ed25519_cost</a></div><div class="item-right docblock-short"><p>Cost of verification of an ed25519 with the Zebra implementation.
The cost depends on the size of the message and is based on benchmarking.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.write_entry_cost.html" title="concordium_smart_contract_engine::constants::write_entry_cost fn">write_entry_cost</a></div><div class="item-right docblock-short"><p>Cost of copying the given amount of bytes to the host (e.g., parameter or
contract state) from the Wasm to host memory.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.write_output_cost.html" title="concordium_smart_contract_engine::constants::write_output_cost fn">write_output_cost</a></div><div class="item-right docblock-short"><p>Cost of writing the given bytes of the return value.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="concordium_smart_contract_engine" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script>
</body></html>