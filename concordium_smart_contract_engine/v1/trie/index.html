<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Implementation of the contract state trie that is exposed as a key-value store to smart contracts."><meta name="keywords" content="rust, rustlang, rust-lang, trie"><title>concordium_smart_contract_engine::v1::trie - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../concordium_smart_contract_engine/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module trie</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="trie" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">concordium_smart_contract_engine</a>::<wbr><a href="../index.html">v1</a>::<wbr><a class="mod" href="#">trie</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/concordium_smart_contract_engine/v1/trie/mod.rs.html#1-56" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Implementation of the contract state trie that is exposed as a key-value
store to smart contracts.</p>
<p>The main top-level types are <a href="enum.PersistentState.html" title="PersistentState"><code>PersistentState</code></a> and <a href="struct.MutableState.html" title="MutableState"><code>MutableState</code></a>.
The <a href="enum.PersistentState.html" title="PersistentState"><code>PersistentState</code></a> is used for long-term storage and is the state that
exists in between contract executions.</p>
<p>During transaction execution we first <a href="enum.PersistentState.html#method.thaw"><code>thaw</code></a> into a
<a href="struct.MutableState.html" title="MutableState"><code>MutableState</code></a> on the first use of the state in the transaction. The
<a href="struct.MutableState.html" title="MutableState"><code>MutableState</code></a> is designed for efficient sharing and rollbacks in case of
execution failure. For each part of execution, e.g., when starting execution
of an entrypoint, the <a href="struct.MutableState.html" title="MutableState"><code>MutableState</code></a> is locked and the underlying
<a href="struct.MutableTrie.html" title="MutableTrie"><code>MutableTrie</code></a> is obtained, via <a href="struct.MutableState.html#method.get_inner"><code>get_inner</code></a> and
<a href="struct.MutableStateInner.html#method.lock">lock</a>. The <a href="struct.MutableTrie.html" title="MutableTrie"><code>MutableTrie</code></a> is the state that the
execution engine operates on.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AttemptToModifyLockedArea.html" title="concordium_smart_contract_engine::v1::trie::AttemptToModifyLockedArea struct">AttemptToModifyLockedArea</a></div><div class="item-right docblock-short"><p>An error used to indicate that an operation could not be completed because
the portion of the trie is locked.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EmptyCollector.html" title="concordium_smart_contract_engine::v1::trie::EmptyCollector struct">EmptyCollector</a></div><div class="item-right docblock-short"><p>Collector that does not collect anything. Mainly for testing.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EntryId.html" title="concordium_smart_contract_engine::v1::trie::EntryId struct">EntryId</a></div><div class="item-right docblock-short"><p>An identifier of an entry stored in the mutable trie.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Hash.html" title="concordium_smart_contract_engine::v1::trie::Hash struct">Hash</a></div><div class="item-right docblock-short"><p>A SHA256 hash.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Hashed.html" title="concordium_smart_contract_engine::v1::trie::Hashed struct">Hashed</a></div><div class="item-right docblock-short"><p>Data together with a cached hash.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Loader.html" title="concordium_smart_contract_engine::v1::trie::Loader struct">Loader</a></div><div class="item-right docblock-short"><p>Generic wrapper for a loader. This implements loadable for any S that can be
seen as a byte array. Since this type is often used with a <code>S = &amp;[u8]</code> we
make it <a href="https://doc.rust-lang.org/1.57.0/core/marker/trait.Copy.html" title="Copy">Copy</a> to be able to share the backing buffer.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MutableState.html" title="concordium_smart_contract_engine::v1::trie::MutableState struct">MutableState</a></div><div class="item-right docblock-short"><p>The mutable contract state. In contrast to <a href="enum.PersistentState.html" title="PersistentState"><code>PersistentState</code></a> this state is
designed for efficient modifications and rollbacks during transaction
execution.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MutableStateInner.html" title="concordium_smart_contract_engine::v1::trie::MutableStateInner struct">MutableStateInner</a></div><div class="item-right docblock-short"><p>This type is a technical device to support lazy conversion of
<a href="enum.PersistentState.html" title="PersistentState"><code>PersistentState</code></a> to <a href="struct.MutableState.html" title="MutableState"><code>MutableState</code></a>. It contains the runtime
representation of the tree that supports efficient updates.
<a href="https://doc.rust-lang.org/1.57.0/core/clone/trait.Clone.html" title="Clone"><code>Clone</code></a> on this structure is designed to be cheap, <strong>and it is a shallow
copy</strong>. Modifications of the inner <a href="struct.MutableTrie.html" title="MutableTrie"><code>MutableTrie</code></a> on either the clone or
the original propagate to the other.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MutableTrie.html" title="concordium_smart_contract_engine::v1::trie::MutableTrie struct">MutableTrie</a></div><div class="item-right docblock-short"><p>A mutable trie that exists during execution of a smart contract.
Generally the <a href="struct.MutableTrie.html" title="MutableTrie"><code>MutableTrie</code></a> is derived from a <a href="struct.Node.html" title="Node"><code>Node</code></a>, i.e., a persistent
trie. After that, during execution, some parts are modified. When that
happens the relevant part of the trie are copied so that the original
persistent trie remains unmodified.
In contrast to the <a href="struct.Node.html" title="Node"><code>Node</code></a>, all modifications on values purely owned by the
<a href="struct.MutableTrie.html" title="MutableTrie"><code>MutableTrie</code></a> are in-place, i.e., this structure is not persistent.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Node.html" title="concordium_smart_contract_engine::v1::trie::Node struct">Node</a></div><div class="item-right docblock-short"><p>A persistent node. Cloning this is relatively cheap, it only copies pointers
and increments reference counts.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PersistentStateIterator.html" title="concordium_smart_contract_engine::v1::trie::PersistentStateIterator struct">PersistentStateIterator</a></div><div class="item-right docblock-short"><p>Iterator over all (key, value) pairs stored in the persistent state.
Values are returned in increasing order of keys.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Reference.html" title="concordium_smart_contract_engine::v1::trie::Reference struct">Reference</a></div><div class="item-right docblock-short"><p>Reference to a storage location where an item may be retrieved.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SizeCollector.html" title="concordium_smart_contract_engine::v1::trie::SizeCollector struct">SizeCollector</a></div><div class="item-right docblock-short"><p>A <a href="trait.Collector.html" title="Collector"><code>Collector</code></a> that keeps track of how much additional data will be
required to store the tree.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Storer.html" title="concordium_smart_contract_engine::v1::trie::Storer struct">Storer</a></div><div class="item-right docblock-short"><p>A generic wrapper that implements <a href="trait.BackingStoreStore.html" title="BackingStoreStore">BackingStoreStore</a> for any inner
type that implements <a href="https://doc.rust-lang.org/1.57.0/std/io/trait.Seek.html" title="Seek">Seek</a> and <a href="https://doc.rust-lang.org/1.57.0/std/io/trait.Write.html" title="Write">Write</a>, such as <code>Cursor&lt;Vec&lt;u8&gt;&gt;</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TooManyIterators.html" title="concordium_smart_contract_engine::v1::trie::TooManyIterators struct">TooManyIterators</a></div><div class="item-right docblock-short"><p>An error used to indicate when too many iterators were acquired at the same
location in the tree. The maximum number is <a href="https://doc.rust-lang.org/1.57.0/std/primitive.u32.html#associatedconstant.MAX" title="u32::MAX">u32::MAX</a>.</p>
</div></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.LoadError.html" title="concordium_smart_contract_engine::v1::trie::LoadError enum">LoadError</a></div><div class="item-right docblock-short"><p>An error that may occur when loading data from persistent storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.LoadWriteError.html" title="concordium_smart_contract_engine::v1::trie::LoadWriteError enum">LoadWriteError</a></div><div class="item-right docblock-short"><p>An error that may occur when storing or loading data from persistent
storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.NoError.html" title="concordium_smart_contract_engine::v1::trie::NoError enum">NoError</a></div><div class="item-right docblock-short"><p>An error that cannot happen, i.e., this type is not inhabited and is used as
an error type of an operation that cannot fail.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PersistentState.html" title="concordium_smart_contract_engine::v1::trie::PersistentState enum">PersistentState</a></div><div class="item-right docblock-short"><p>The persistent contract state.
Clone on this structure is designed to be cheap, and it is a shallow copy.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.WriteError.html" title="concordium_smart_contract_engine::v1::trie::WriteError enum">WriteError</a></div><div class="item-right docblock-short"><p>An error that may occur when writing data to persistent storage.</p>
</div></div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.AllocCounter.html" title="concordium_smart_contract_engine::v1::trie::AllocCounter trait">AllocCounter</a></div><div class="item-right docblock-short"><p>A trait that supports counting new memory allocations in the tree.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.BackingStoreLoad.html" title="concordium_smart_contract_engine::v1::trie::BackingStoreLoad trait">BackingStoreLoad</a></div><div class="item-right docblock-short"><p>Trait implemented by types that can load data from given locations.
Dual to <a href="trait.BackingStoreStore.html" title="BackingStoreStore"><code>BackingStoreStore</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.BackingStoreStore.html" title="concordium_smart_contract_engine::v1::trie::BackingStoreStore trait">BackingStoreStore</a></div><div class="item-right docblock-short"><p>Trait implemented by types that can be used to store binary data, and return
a handle for loading data. Dual to <a href="trait.BackingStoreLoad.html" title="BackingStoreLoad"><code>BackingStoreLoad</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Collector.html" title="concordium_smart_contract_engine::v1::trie::Collector trait">Collector</a></div><div class="item-right docblock-short"><p>A type that can be used to collect auxiliary information while a mutable
trie is being frozen. Particular use-cases of this are collecting the size
of new data, as well as new persistent nodes.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Loadable.html" title="concordium_smart_contract_engine::v1::trie::Loadable trait">Loadable</a></div><div class="item-right docblock-short"><p>A trait implemented by types that can be loaded from a <a href="trait.BackingStoreLoad.html" title="BackingStoreLoad">BackingStoreLoad</a>
storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ToSHA256.html" title="concordium_smart_contract_engine::v1::trie::ToSHA256 trait">ToSHA256</a></div><div class="item-right docblock-short"><p>Compute SHA256 of data given the context. The context is sometimes needed
since data is not available in memory and must be first loaded from, e.g.,
external storage</p>
</div></div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.LoadCallback.html" title="concordium_smart_contract_engine::v1::trie::LoadCallback type">LoadCallback</a></div><div class="item-right docblock-short"><p>A <a href="trait.BackingStoreLoad.html">loader</a> implemented by an external function.
This is the dual to <a href="type.StoreCallback.html" title="StoreCallback"><code>StoreCallback</code></a></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.LoadResult.html" title="concordium_smart_contract_engine::v1::trie::LoadResult type">LoadResult</a></div><div class="item-right docblock-short"><p>Result of loading data from persistent storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.LoadStoreResult.html" title="concordium_smart_contract_engine::v1::trie::LoadStoreResult type">LoadStoreResult</a></div><div class="item-right docblock-short"><p>Result of loading or storing data from or to persistent storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.StateTrie.html" title="concordium_smart_contract_engine::v1::trie::StateTrie type">StateTrie</a></div><div class="item-right docblock-short"><p>A lock guard derived from <a href="struct.MutableStateInner.html" title="MutableStateInner"><code>MutableStateInner</code></a>. Only one can exist at the
time.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.StoreCallback.html" title="concordium_smart_contract_engine::v1::trie::StoreCallback type">StoreCallback</a></div><div class="item-right docblock-short"><p>A <a href="trait.BackingStoreStore.html">storer</a> implemented by an external function.
The function is passed a pointer to data to store, and the size of data. It
should return the location where the data can be loaded via a
<a href="type.LoadCallback.html" title="LoadCallback"><code>LoadCallback</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.StoreResult.html" title="concordium_smart_contract_engine::v1::trie::StoreResult type">StoreResult</a></div><div class="item-right docblock-short"><p>Result of storing data in persistent storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Value.html" title="concordium_smart_contract_engine::v1::trie::Value type">Value</a></div><div class="item-right docblock-short"><p>Value stored in the trie.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="concordium_smart_contract_engine" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div>
    <script src="../../../main.js"></script>
</body></html>