<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Implementation of execution of V1 contracts."><meta name="keywords" content="rust, rustlang, rust-lang, v1"><title>concordium_smart_contract_engine::v1 - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../concordium_smart_contract_engine/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module v1</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="v1" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">concordium_smart_contract_engine</a>::<wbr><a class="mod" href="#">v1</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/concordium_smart_contract_engine/v1/mod.rs.html#1-1965" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Implementation of execution of V1 contracts.</p>
<p>This contains only the execution of the Wasm parts and does not include the
handling of invoked operations (e.g., calling another contract, sending
transfers). That is handled by a separate scheduler component.</p>
<p>The main entrypoints in this module are</p>
<ul>
<li><a href="fn.invoke_init.html" title="invoke_init"><code>invoke_init</code></a> for invoking an init function to create a new instance</li>
<li><a href="fn.invoke_receive.html" title="invoke_receive"><code>invoke_receive</code></a> for invoking an entrypoint of an existing instance</li>
<li><a href="fn.resume_receive.html" title="resume_receive"><code>resume_receive</code></a> for resuming execution of an interrupted entrypoint</li>
</ul>
<p>These methods are intended to be used on <a href="../../concordium_wasm/artifact/struct.Artifact.html" title="Artifact"><code>Artifact</code></a>’s obtained using
<a href="../../concordium_wasm/utils/fn.instantiate_with_metering.html"><code>instantiate_with_metering</code></a> using
<a href="struct.ConcordiumAllowedImports.html" title="ConcordiumAllowedImports"><code>ConcordiumAllowedImports</code></a> for handling imports.</p>
<p>In addition to the above methods there are auxiliary helpers</p>
<ul>
<li><a href="fn.invoke_init_from_artifact.html" title="invoke_init_from_artifact"><code>invoke_init_from_artifact</code></a> and <a href="fn.invoke_receive_from_artifact.html" title="invoke_receive_from_artifact"><code>invoke_receive_from_artifact</code></a> which
first parse an <a href="../../concordium_wasm/artifact/struct.Artifact.html" title="Artifact"><code>Artifact</code></a> and then run the corresponding <code>invoke_*</code>
function.</li>
<li><a href="fn.invoke_init_from_source.html" title="invoke_init_from_source"><code>invoke_init_from_source</code></a> and <a href="fn.invoke_receive_from_source.html" title="invoke_receive_from_source"><code>invoke_receive_from_source</code></a> which first
parse and validate a Wasm module, then convert it to an <a href="../../concordium_wasm/artifact/struct.Artifact.html" title="Artifact"><code>Artifact</code></a>, and
then run it using the appropriate <code>invoke_*</code> function.</li>
<li><a href="fn.invoke_init_with_metering_from_source.html" title="invoke_init_with_metering_from_source"><code>invoke_init_with_metering_from_source</code></a> and
<a href="fn.invoke_receive_with_metering_from_source.html" title="invoke_receive_with_metering_from_source"><code>invoke_receive_with_metering_from_source</code></a> which first parse and
validate the Wasm module, then inject cost metering instructions, and then
convert it to an <a href="../../concordium_wasm/artifact/struct.Artifact.html" title="Artifact"><code>Artifact</code></a> and run it using the appropriate <code>invoke_*</code>
function.</li>
</ul>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="trie/index.html" title="concordium_smart_contract_engine::v1::trie mod">trie</a></div><div class="item-right docblock-short"><p>Implementation of the contract state trie that is exposed as a key-value
store to smart contracts.</p>
</div></div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ConcordiumAllowedImports.html" title="concordium_smart_contract_engine::v1::ConcordiumAllowedImports struct">ConcordiumAllowedImports</a></div><div class="item-right docblock-short"><p>Allowed imports for V1 modules. Whether some imports are allowed
depends on the protocol version that is used to validate the module.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InitInvocation.html" title="concordium_smart_contract_engine::v1::InitInvocation struct">InitInvocation</a></div><div class="item-right docblock-short"><p>Collection of information relevant to invoke a init-function.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InstanceState.html" title="concordium_smart_contract_engine::v1::InstanceState struct">InstanceState</a></div><div class="item-right docblock-short"><p>The runtime representation of the contract state. This collects all the
pieces of data needed to efficiently use the state.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InstanceStateEntry.html" title="concordium_smart_contract_engine::v1::InstanceStateEntry struct">InstanceStateEntry</a></div><div class="item-right docblock-short"><p>first bit is ignored, the next 31 indicate a generation,
the final 32 indicates an index in the entry_mapping.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InvokeFromArtifactCtx.html" title="concordium_smart_contract_engine::v1::InvokeFromArtifactCtx struct">InvokeFromArtifactCtx</a></div><div class="item-right docblock-short"><p>Common data used by the <code>invoke_*_from_artifact</code> family of functions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InvokeFromSourceCtx.html" title="concordium_smart_contract_engine::v1::InvokeFromSourceCtx struct">InvokeFromSourceCtx</a></div><div class="item-right docblock-short"><p>Common data used by the <code>invoke_*_from_source</code> family of functions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ProcessedImports.html" title="concordium_smart_contract_engine::v1::ProcessedImports struct">ProcessedImports</a></div><div class="item-right docblock-short"><p>Imports allowed for <code>v1</code> contracts processed into a format that is faster to
use during execution. Instead of keeping names of imports they are processed
into an enum with integer tags.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ReceiveContext.html" title="concordium_smart_contract_engine::v1::ReceiveContext struct">ReceiveContext</a></div><div class="item-right docblock-short"><p>Chain context accessible to receive methods of V1 contracts.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ReceiveInvocation.html" title="concordium_smart_contract_engine::v1::ReceiveInvocation struct">ReceiveInvocation</a></div><div class="item-right docblock-short"><p>Collection of information relevant to invoke a receive-function.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ReceiveParams.html" title="concordium_smart_contract_engine::v1::ReceiveParams struct">ReceiveParams</a></div><div class="item-right docblock-short"><p>Runtime parameters that affect the limits placed on the
entrypoint execution.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SavedHost.html" title="concordium_smart_contract_engine::v1::SavedHost struct">SavedHost</a></div><div class="item-right docblock-short"><p>Host that is saved between handling of operations. This contains sufficient
information to resume execution once control returns to the contract.</p>
</div></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.InitResult.html" title="concordium_smart_contract_engine::v1::InitResult enum">InitResult</a></div><div class="item-right docblock-short"><p>Result of execution of the contract’s init function.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Interrupt.html" title="concordium_smart_contract_engine::v1::Interrupt enum">Interrupt</a></div><div class="item-right docblock-short"><p>Interrupt triggered by the smart contract to execute an instruction on the
host, either an account transfer, a smart contract call or an upgrade
instruction.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.InvokeFailure.html" title="concordium_smart_contract_engine::v1::InvokeFailure enum">InvokeFailure</a></div><div class="item-right docblock-short"><p>The kind of errors that may occur during handling of contract <code>invoke</code> or
<code>upgrade</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.InvokeResponse.html" title="concordium_smart_contract_engine::v1::InvokeResponse enum">InvokeResponse</a></div><div class="item-right docblock-short"><p>Response from an invoke call.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.ReceiveResult.html" title="concordium_smart_contract_engine::v1::ReceiveResult enum">ReceiveResult</a></div><div class="item-right docblock-short"><p>Result of execution of a receive function.</p>
</div></div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.HasReceiveContext.html" title="concordium_smart_contract_engine::v1::HasReceiveContext trait">HasReceiveContext</a></div><div class="item-right docblock-short"><p>A receive context for V1 contracts.</p>
</div></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_init.html" title="concordium_smart_contract_engine::v1::invoke_init fn">invoke_init</a></div><div class="item-right docblock-short"><p>Invokes an init-function from a given artifact</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_init_from_artifact.html" title="concordium_smart_contract_engine::v1::invoke_init_from_artifact fn">invoke_init_from_artifact</a></div><div class="item-right docblock-short"><p>Invokes an init-function from a given <strong>serialized</strong> artifact.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_init_from_source.html" title="concordium_smart_contract_engine::v1::invoke_init_from_source fn">invoke_init_from_source</a></div><div class="item-right docblock-short"><p>Invokes an init-function from a <strong>serialized</strong> Wasm module.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_init_with_metering_from_source.html" title="concordium_smart_contract_engine::v1::invoke_init_with_metering_from_source fn">invoke_init_with_metering_from_source</a></div><div class="item-right docblock-short"><p>Same as <code>invoke_init_from_source</code>, except that the module has cost
accounting instructions inserted before the init function is called.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_receive.html" title="concordium_smart_contract_engine::v1::invoke_receive fn">invoke_receive</a></div><div class="item-right docblock-short"><p>Invokes a receive-function from a given <a href="../../concordium_wasm/artifact/struct.Artifact.html">artifact</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_receive_from_artifact.html" title="concordium_smart_contract_engine::v1::invoke_receive_from_artifact fn">invoke_receive_from_artifact</a></div><div class="item-right docblock-short"><p>Invokes a receive-function from a given <strong>serialized</strong> artifact.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_receive_from_source.html" title="concordium_smart_contract_engine::v1::invoke_receive_from_source fn">invoke_receive_from_source</a></div><div class="item-right docblock-short"><p>Invokes a receive-function from a given <strong>serialized</strong> Wasm module.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_receive_with_metering_from_source.html" title="concordium_smart_contract_engine::v1::invoke_receive_with_metering_from_source fn">invoke_receive_with_metering_from_source</a></div><div class="item-right docblock-short"><p>Invokes a receive-function from a given <strong>serialized</strong> Wasm module. Before
execution the Wasm module is injected with cost metering.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.resume_receive.html" title="concordium_smart_contract_engine::v1::resume_receive fn">resume_receive</a></div><div class="item-right docblock-short"><p>Resume execution of the receive method after handling the interrupt.</p>
</div></div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.InstanceCounter.html" title="concordium_smart_contract_engine::v1::InstanceCounter type">InstanceCounter</a></div><div class="item-right docblock-short"><p>A counter of the “state instance”. When contract execution is interrupted
and then resumed, if the state has been modified by the handling of the
operation then all state entries that were handed out before the interrupt
are invalidated. This is achieved by incrementing the instance counter.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ParameterRef.html" title="concordium_smart_contract_engine::v1::ParameterRef type">ParameterRef</a></div><div class="item-right docblock-short"><p>Parameter whose ownership is tracked statically.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ParameterVec.html" title="concordium_smart_contract_engine::v1::ParameterVec type">ParameterVec</a></div><div class="item-right docblock-short"><p>Parameter whose ownership is tracked dynamically.
This is needed, for example, when execution passes through Haskell and Rust.
Ideally this would be Arc&lt;<a href="https://doc.rust-lang.org/1.57.0/std/primitive.u8.html" title="u8">u8</a>&gt; but then this cannot be passed via the FFI
boundary directly since <a href="https://doc.rust-lang.org/1.57.0/std/primitive.u8.html" title="u8">u8</a> is not Sized. To avoid a third type we settle
on Vec<u8>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ReceiveInterruptedState.html" title="concordium_smart_contract_engine::v1::ReceiveInterruptedState type">ReceiveInterruptedState</a></div><div class="item-right docblock-short"><p>State of the suspended execution of the receive function.
This retains both the module that is executed, as well the host.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ReturnValue.html" title="concordium_smart_contract_engine::v1::ReturnValue type">ReturnValue</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.StateResult.html" title="concordium_smart_contract_engine::v1::StateResult type">StateResult</a></div><div class="item-right docblock-short"></div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="concordium_smart_contract_engine" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script>
</body></html>