<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Definition of energy costs of instructions."><meta name="keywords" content="rust, rustlang, rust-lang, cost"><title>wasm_transform::metering_transformation::cost - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../wasm_transform/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module cost</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="cost" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">wasm_transform</a>::<wbr><a href="../index.html">metering_transformation</a>::<wbr><a class="mod" href="#">cost</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/wasm_transform/metering_transformation.rs.html#49-331" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Definition of energy costs of instructions.</p>
</div></details><h2 id="constants" class="section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BINOP.html" title="wasm_transform::metering_transformation::cost::BINOP constant">BINOP</a></div><div class="item-right docblock-short"><p>Base cost of a binary instruction.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BOUNDS.html" title="wasm_transform::metering_transformation::cost::BOUNDS constant">BOUNDS</a></div><div class="item-right docblock-short"><p>Cost of a bounds check in, for example, BrTable, and memory loads
and stores.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BR_IF.html" title="wasm_transform::metering_transformation::cost::BR_IF constant">BR_IF</a></div><div class="item-right docblock-short"><p>BR_IF is almost the same as an IF statement, so we price it the same.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.CONST.html" title="wasm_transform::metering_transformation::cost::CONST constant">CONST</a></div><div class="item-right docblock-short"><p>Cost of a <code>const</code> instruction.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.DIV.html" title="wasm_transform::metering_transformation::cost::DIV constant">DIV</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.DROP.html" title="wasm_transform::metering_transformation::cost::DROP constant">DROP</a></div><div class="item-right docblock-short"><p>Parametric instructions</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.FUNC_FRAME_BASE.html" title="wasm_transform::metering_transformation::cost::FUNC_FRAME_BASE constant">FUNC_FRAME_BASE</a></div><div class="item-right docblock-short"><p>Part of a cost of a function call related to allocating
a new function frame and storing values of locals, etc.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.GET_GLOBAL.html" title="wasm_transform::metering_transformation::cost::GET_GLOBAL constant">GET_GLOBAL</a></div><div class="item-right docblock-short"><p>Looking up globals is cheap compared to linear memory.
They are essentially the same as locals, except they are in a different
array.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.GET_LOCAL.html" title="wasm_transform::metering_transformation::cost::GET_LOCAL constant">GET_LOCAL</a></div><div class="item-right docblock-short"><p>Local variable instructions are cheap. We treat them as stack
operations.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.IF_STATEMENT.html" title="wasm_transform::metering_transformation::cost::IF_STATEMENT constant">IF_STATEMENT</a></div><div class="item-right docblock-short"><p>The if statement boils down to a test and a jump afterwards.
Jumps are simply setting the instruction pointer.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.JUMP.html" title="wasm_transform::metering_transformation::cost::JUMP constant">JUMP</a></div><div class="item-right docblock-short"><p>Cost of a jump (either Br, Loop, or analogous).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.LOAD_WORD.html" title="wasm_transform::metering_transformation::cost::LOAD_WORD constant">LOAD_WORD</a></div><div class="item-right docblock-short"><p>Memory instructions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MEMGROW.html" title="wasm_transform::metering_transformation::cost::MEMGROW constant">MEMGROW</a></div><div class="item-right docblock-short"><p>Constant part for the memory grow instruction. The variable part is
charged for by the host function.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MEMSIZE.html" title="wasm_transform::metering_transformation::cost::MEMSIZE constant">MEMSIZE</a></div><div class="item-right docblock-short"><p>Checking memory size is pretty cheap, it is just a vec.len() call.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MUL.html" title="wasm_transform::metering_transformation::cost::MUL constant">MUL</a></div><div class="item-right docblock-short"><p>See for example <a href="https://streamhpc.com/blog/2012-07-16/how-expensive-is-an-operation-on-a-cpu/">https://streamhpc.com/blog/2012-07-16/how-expensive-is-an-operation-on-a-cpu/</a>
The cost of <code>MUL</code>, <code>DIV</code> and <code>REM</code> is in general more, so we account for
that. However the ratio compared to add is not that much more since our
current implementation is an interpreter, and consequently there are
overheads in argument handling that dominate the costs.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NOP.html" title="wasm_transform::metering_transformation::cost::NOP constant">NOP</a></div><div class="item-right docblock-short"><p>Control instructions</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.REM.html" title="wasm_transform::metering_transformation::cost::REM constant">REM</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.SELECT.html" title="wasm_transform::metering_transformation::cost::SELECT constant">SELECT</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.SET_GLOBAL.html" title="wasm_transform::metering_transformation::cost::SET_GLOBAL constant">SET_GLOBAL</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.SET_LOCAL.html" title="wasm_transform::metering_transformation::cost::SET_LOCAL constant">SET_LOCAL</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.SIMPLE_BINOP.html" title="wasm_transform::metering_transformation::cost::SIMPLE_BINOP constant">SIMPLE_BINOP</a></div><div class="item-right docblock-short"><p>Cost of a simple binary instruction. This includes all bit
operations, and addition and subtraction.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.SIMPLE_UNOP.html" title="wasm_transform::metering_transformation::cost::SIMPLE_UNOP constant">SIMPLE_UNOP</a></div><div class="item-right docblock-short"><p>Cost of a simple unary instruction. Which at present contains
all unary numeric instructions.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.TEE_LOCAL.html" title="wasm_transform::metering_transformation::cost::TEE_LOCAL constant">TEE_LOCAL</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.TEST.html" title="wasm_transform::metering_transformation::cost::TEST constant">TEST</a></div><div class="item-right docblock-short"><p>Cost of a boolean test.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.UNOP.html" title="wasm_transform::metering_transformation::cost::UNOP constant">UNOP</a></div><div class="item-right docblock-short"><p>Numeric instructions</p>
</div></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.br_table.html" title="wasm_transform::metering_transformation::cost::br_table fn">br_table</a></div><div class="item-right docblock-short"><p>Cost of a branch with table (switch statement). This involves bounds
checking on the array of labels, and then a normal branch.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.branch.html" title="wasm_transform::metering_transformation::cost::branch fn">branch</a></div><div class="item-right docblock-short"><p>Cost of an unconditional jump with the given label arity.
The label arity for us is either 0 or 1, since we do not support
multiple return values.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.call_indirect.html" title="wasm_transform::metering_transformation::cost::call_indirect fn">call_indirect</a></div><div class="item-right docblock-short"><p>Cost of call_indirect with the given number of arguments and results.
This is expensive since it involves a dynamic type check.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.copy_stack.html" title="wasm_transform::metering_transformation::cost::copy_stack fn">copy_stack</a></div><div class="item-right docblock-short"><p>Copy n elements from one place in the stack to another.
Used by jumps and function returns.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_cost.html" title="wasm_transform::metering_transformation::cost::get_cost fn">get_cost</a></div><div class="item-right docblock-short"><p>Get the cost of the given instruction in the context of the stack of
labels, and the module.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_after.html" title="wasm_transform::metering_transformation::cost::invoke_after fn">invoke_after</a></div><div class="item-right docblock-short"><p>Cost incurred by the number of locals when invoking a function (to be
charged after invocation). The number of locals is only the number of
declared locals, not including function parameters.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.invoke_before.html" title="wasm_transform::metering_transformation::cost::invoke_before fn">invoke_before</a></div><div class="item-right docblock-short"><p>Cost for invoking a function <strong>before</strong> the entering the function.
This excludes the cost incurred by the number of locals the function
defines (for the latter, see <code>invoke_after</code>).</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.read_stack.html" title="wasm_transform::metering_transformation::cost::read_stack fn">read_stack</a></div><div class="item-right docblock-short"><p>Read n elements from the stack.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.store.html" title="wasm_transform::metering_transformation::cost::store fn">store</a></div><div class="item-right docblock-short"><p>Store n bytes in linear memory.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.type_check.html" title="wasm_transform::metering_transformation::cost::type_check fn">type_check</a></div><div class="item-right docblock-short"><p>Cost of a dynamic type check. The argument is the number of types
i.e., parameters + results that need to be checked.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.write_stack.html" title="wasm_transform::metering_transformation::cost::write_stack fn">write_stack</a></div><div class="item-right docblock-short"><p>Write n elements to the stack.</p>
</div></div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Energy.html" title="wasm_transform::metering_transformation::cost::Energy type">Energy</a></div><div class="item-right docblock-short"></div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="wasm_transform" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div>
    <script src="../../../main.js"></script>
</body></html>